<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>P.F.I 11 - Seguimiento Acad√©mico</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    input, select, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    .promedio {
      margin-top: 20px;
      font-weight: bold;
      color: #2980b9;
    }
    .acciones button {
      margin: 0 2px;
    }
    .filtros {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }
    .filtros > * {
      flex: 1;
    }
    button {
      transition: background 0.3s;
    }
    button:hover {
      background: #dfe6e9;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üìò P.F.I - 11</h1>
    <h2>Registro de Notas por Per√≠odo</h2>

    <label for="materia">Materia:</label>
    <input type="text" id="materia" placeholder="Ej: Matem√°ticas">

    <label for="periodo">Per√≠odo:</label>
    <select id="periodo">
      <option value="1">Per√≠odo 1</option>
      <option value="2">Per√≠odo 2</option>
      <option value="3">Per√≠odo 3</option>
    </select>

    <label for="nota">Nota:</label>
    <select id="nota">
      <option value="J">J - Bajo (1.0 a 3.2)</option>
      <option value="B">B - B√°sico (3.3 a 3.9)</option>
      <option value="A">A - Alto (4.0 a 4.4)</option>
      <option value="S">S - Superior (4.5 a 5.0)</option>
    </select>

    <button onclick="agregarNota()">Agregar Nota</button>

    <div class="filtros">
      <input type="text" id="filtroMateria" placeholder="Filtrar por materia" oninput="actualizarTabla()">
      <select id="filtroPeriodo" onchange="actualizarTabla()">
        <option value="">Todos los per√≠odos</option>
        <option value="1">Per√≠odo 1</option>
        <option value="2">Per√≠odo 2</option>
        <option value="3">Per√≠odo 3</option>
      </select>
      <select id="filtroNota" onchange="actualizarTabla()">
        <option value="">Todas las notas</option>
        <option value="J">J</option>
        <option value="B">B</option>
        <option value="A">A</option>
        <option value="S">S</option>
      </select>
    </div>

    <table id="tablaNotas">
      <thead>
        <tr>
          <th>Materia</th>
          <th>Per√≠odo</th>
          <th>Nota</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="promedio" id="promedio">Promedio: -</div>

    <button onclick="exportarExcel()">Exportar a Excel</button>
    <button onclick="exportarPDF()">Exportar a PDF</button>
  </div>

  <script>
    let notas = JSON.parse(localStorage.getItem("notasEduTrack")) || [];

    const equivalencias = {
      'J': 2.5,  // Promedio entre 1.0 y 3.2
      'B': 3.6,  // Promedio entre 3.3 y 3.9
      'A': 4.2,  // Promedio entre 4.0 y 4.4
      'S': 4.8   // Promedio entre 4.5 y 5.0
    };

    function guardarNotas() {
      localStorage.setItem("notasEduTrack", JSON.stringify(notas));
    }

    function agregarNota() {
      const materia = document.getElementById("materia").value.trim();
      const periodo = document.getElementById("periodo").value;
      const nota = document.getElementById("nota").value;

      if (!materia || !nota) {
        alert("Por favor completa todos los campos.");
        return;
      }

      // Validaci√≥n para evitar duplicados por materia y per√≠odo
      if (notas.some(n => n.materia.toLowerCase() === materia.toLowerCase() && n.periodo === periodo)) {
        alert("Ya has registrado una nota para esta materia en este per√≠odo.");
        return;
      }

      notas.push({ materia, periodo, nota });
      guardarNotas();
      actualizarTabla();

      document.getElementById("materia").value = "";
      document.getElementById("periodo").value = "1";
      document.getElementById("nota").value = "J";
    }

    function eliminarNota(index) {
      if (confirm("¬øDeseas eliminar esta nota?")) {
        notas.splice(index, 1);
        guardarNotas();
        actualizarTabla();
      }
    }

    function actualizarTabla() {
      const tbody = document.querySelector("#tablaNotas tbody");
      tbody.innerHTML = "";

      const filtroMateria = document.getElementById("filtroMateria").value.toLowerCase();
      const filtroPeriodo = document.getElementById("filtroPeriodo").value;
      const filtroNota = document.getElementById("filtroNota").value;

      const notasFiltradas = notas.filter((n) => {
        return (
          (!filtroMateria || n.materia.toLowerCase().includes(filtroMateria)) &&
          (!filtroPeriodo || n.periodo === filtroPeriodo) &&
          (!filtroNota || n.nota === filtroNota)
        );
      });

      notasFiltradas.forEach((n, indexGlobal) => {
        const row = `<tr>
          <td>${n.materia}</td>
          <td>${n.periodo}</td>
          <td>${n.nota}</td>
          <td class="acciones">
            <button onclick="eliminarNota(${notas.indexOf(n)})">üóëÔ∏è</button>
          </td>
        </tr>`;
        tbody.innerHTML += row;
      });

      calcularPromedio(notasFiltradas, filtroPeriodo);
    }

    function calcularPromedio(lista, filtroPeriodo) {
      const promedioDiv = document.getElementById("promedio");

      if (lista.length === 0) {
        promedioDiv.textContent = "Promedio: -";
        return;
      }

      const suma = lista.reduce((acc, n) => acc + equivalencias[n.nota], 0);
      const promedio = suma / lista.length;
      let calificacion;

      if (promedio < 3.3) calificacion = "J - Bajo";
      else if (promedio < 4.0) calificacion = "B - B√°sico";
      else if (promedio < 4.5) calificacion = "A - Alto";
      else calificacion = "S - Superior";

      if (filtroPeriodo) {
        promedioDiv.textContent = `Promedio Per√≠odo ${filtroPeriodo}: ${promedio.toFixed(2)} (${calificacion})`;
      } else {
        promedioDiv.textContent = `Promedio General: ${promedio.toFixed(2)} (${calificacion})`;
      }
    }

    function exportarExcel() {
      const data = [["Materia", "Per√≠odo", "Nota"]];
      notas.forEach(n => data.push([n.materia, n.periodo, n.nota]));
      const hoja = XLSX.utils.aoa_to_sheet(data);
      const libro = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(libro, hoja, "Notas");
      XLSX.writeFile(libro, "notas.xlsx");
    }

    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("Reporte de Notas - EduTrack 11", 20, 15);
      doc.setFontSize(12);

      let y = 30;
      doc.text("Materia", 20, y);
      doc.text("Per√≠odo", 80, y);
      doc.text("Nota", 140, y);
      y += 10;

      notas.forEach(n => {
        doc.text(n.materia, 20, y);
        doc.text(n.periodo, 80, y);
        doc.text(n.nota, 140, y);
        y += 10;
        if (y > 280) {
          doc.addPage();
          y = 20;
        }
      });

      doc.save("notas.pdf");
    }

    // Inicializar tabla al cargar
    actualizarTabla();
  </script>
</body>
</html>
